name: Telegram Notifications

on:
  pull_request_target:
    types: [opened, closed, reopened]
  push:

jobs:
  notify-telegram:
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram Notification
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: -1002791189479  # Ø¢ÛŒØ¯ÛŒ Ú¯Ø±ÙˆÙ‡ Ø´Ù…Ø§
          TOPIC_ID: 1698           # Ø¢ÛŒØ¯ÛŒ ØªØ§Ù¾ÛŒÚ©
        run: |
          DESTRUCTIVE_MESSAGES=(
            "ğŸš€ Ú©Ø¯Ø§Ù…Ùˆ Ù¾Ø§Ú†ÛŒØ¯Ù… ØªÙˆ Ù¾Ø±ÙˆÚ˜Ù‡!"
            "ğŸ”¥ Ø±ÛŒØ¯Ù… ØªÙˆ Ù¾Ø±ÙˆÚ˜Ù‡!"
            "ğŸ˜‚ Ú©Ú©Ù‡ Ø±Ùˆ Ù„Ø§ Ú©ÙˆÚ©Ùˆ Ú©Ø±Ø¯Ù…!"
            "ğŸ’¥ ÛŒÙ‡ Ø¨Ø§Ú¯ Ø¯ÛŒÚ¯Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù… Ø¨Ù‡ Ú©Ø¯!"
            "ğŸ”¦ Ø¨Ø§ Ø³Ø±Ø¹Øª Ù†ÙˆØ± Ø±ÛŒØ¯Ù… Ø¨Ù‡ Ú©Ø¯!"
            "ğŸ¯ ÛŒÙ‡ Ù…Ø´Ú©Ù„ Ø¬Ø¯ÛŒØ¯ ØªÙˆÙ„ÛŒØ¯ Ú©Ø±Ø¯Ù…!"
          )
          CREATIVE_MESSAGES=(
            "ğŸ˜ Ø®ÙˆØ¯ØªÙˆÙ† Ø¨Ø±ÛŒØ²ÛŒØ¯ Ù¾Ø´Ù…Ø§ØªÙˆÙ† Ø¨Ù…ÙˆÙ†Ù‡!"
            "ğŸ’» ÛŒÙ‡ Ø´Ø§Ù‡Ú©Ø§Ø± Ø¬Ø¯ÛŒØ¯ Ø®Ù„Ù‚ Ú©Ø±Ø¯Ù…!"
            "âœ¨ Ú©Ø¯ÛŒ Ù†ÙˆØ´ØªÙ… Ú©Ù‡ Ø­ØªÛŒ Ø®ÙˆØ¯Ù… Ø§Ø²Ø´ Ù…ÛŒâ€ŒØªØ±Ø³Ù…!"
            "ğŸš€ ÛŒÙ‡ ÙˆÛŒÚ˜Ú¯ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ Ø¯Ù†ÛŒØ§ Ø¢ÙˆØ±Ø¯Ù…!"
            "ğŸ¨ ÛŒÙ‡ Ø§Ø«Ø± Ù‡Ù†Ø±ÛŒ Ø¯ÛŒÚ¯Ù‡ Ø³Ø§Ø®ØªÙ…!"
            "âš¡ Ø¨Ø±Ù‚ Ø²Ø¯Ù… Ø¨Ù‡ Ú©ÛŒØ¨ÙˆØ±Ø¯ØŒ Ú©Ø¯ Ø¬Ø§Ø¯ÙˆÛŒÛŒ Ø¨ÛŒØ±ÙˆÙ† Ø§ÙˆÙ…Ø¯!"
            "ğŸ”® ÛŒÙ‡ Ø¬Ø§Ø¯ÙˆÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù…!"
            "âš¡ Ø­Ù…Ø§Ù„ Ø¨Ø±Ù‚ÛŒ pr Ø²Ø¯!"
          )
          APPROVAL_MESSAGES=(
            "âœ… ÛŒÙ‡ Ø´Ø§Ù‡Ú©Ø§Ø± Ø¯ÛŒÚ¯Ù‡ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯!"
            "ğŸ‰ Ú©Ø¯Ù… Ø§Ù†Ù‚Ø¯Ø± Ø¨Ø§Ø­Ø§Ù„ Ø¨ÙˆØ¯ Ú©Ù‡ Ù…Ø±Ø¬ Ø´Ø¯!"
            "ğŸ† ÛŒÚ©ÛŒ Ø¯ÛŒÚ¯Ù‡ Ø§Ø² Ø¢Ø«Ø§Ø± Ù‡Ù†Ø±ÛŒ Ù…Ù† ØªØ§ÛŒÛŒØ¯ Ø´Ø¯!"
            "ğŸŒŸ Ø¯Ø±Ø®Ø´Ø´ Ú©Ø¯Ù… Ú†Ø´Ù… Ù‡Ù…Ù‡ Ø±Ùˆ Ø²Ø¯!"
            "ğŸ‘‘ ÛŒÙ‡ Ù¾Ø§Ø¯Ø´Ø§Ù‡ÛŒ Ø¯ÛŒÚ¯Ù‡ ÙØªØ­ Ú©Ø±Ø¯Ù…!"
            "ğŸš€ Ú©Ø¯Ù… Ù…Ø«Ù„ Ù…ÙˆØ´Ú© Ø¨Ù‡ production Ø±ÙØª!"
            "ğŸ’ ÛŒÙ‡ Ø¬ÙˆØ§Ù‡Ø± Ø¯ÛŒÚ¯Ù‡ Ø¨Ù‡ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!"
          )

          PROJECT_NAME="${{ github.repository }}"

          if [[ "${{ github.event_name }}" == "pull_request_target" ]]; then
              if [[ "${{ github.event.action }}" == "opened" ]]; then
                  RANDOM_FUN=${CREATIVE_MESSAGES[$RANDOM % ${#CREATIVE_MESSAGES[@]}]}
                  MESSAGE="$RANDOM_FUN%0A%0AğŸ“‚ *Project:* \$PROJECT_NAME%0AğŸ“¢ New Pull Request opened%0AğŸ”— [View PR](${{ github.event.pull_request.html_url }})%0A%0AğŸ‘¤ *Assignee:* ${{ github.actor }}%0A%0AğŸ·ï¸ *Meta Code Team*"
              elif [[ "${{ github.event.action }}" == "closed" && "${{ github.event.pull_request.merged }}" == "true" ]]; then
                  RANDOM_FUN=${APPROVAL_MESSAGES[$RANDOM % ${#APPROVAL_MESSAGES[@]}]}
                  MESSAGE="$RANDOM_FUN%0A%0AğŸ“‚ *Project:* \$PROJECT_NAME%0Aâœ… Pull Request merged successfully%0AğŸ”— [View Details](${{ github.event.pull_request.html_url }})%0A%0AğŸ‘¤ *Assignee:* ${{ github.actor }}%0A%0AğŸ·ï¸ *Meta Code Team*"
              else
                  RANDOM_FUN=${DESTRUCTIVE_MESSAGES[$RANDOM % ${#DESTRUCTIVE_MESSAGES[@]}]}
                  MESSAGE="$RANDOM_FUN%0A%0AğŸ“‚ *Project:* \$PROJECT_NAME%0AâŒ Pull Request closed without merge%0AğŸ”— [View Details](${{ github.event.pull_request.html_url }})%0A%0AğŸ‘¤ *Assignee:* ${{ github.actor }}%0A%0AğŸ·ï¸ *Meta Code Team*"
              fi

          elif [[ "${{ github.event_name }}" == "push" ]]; then
              COMMITS=""
              for commit in $(jq -c '.commits[]' <<< '${{ toJson(github.event.commits) }}'); do
                  AUTHOR=$(jq -r '.author.name' <<< "$commit")
                  MSG=$(jq -r '.message' <<< "$commit")
                  URL=$(jq -r '.url' <<< "$commit")
                  COMMITS="$COMMITS%0Aâ€¢ ğŸ‘¨â€ğŸ’» $AUTHOR: [$MSG]($URL)"
              done
              MESSAGE="ğŸ“‚ *Project:* \$PROJECT_NAME%0AğŸš€ New push to branch \${{ github.ref_name }}%0AğŸ”— [View Commits](${{ github.event.compare }})%0A$COMMITS"

          else
              RANDOM_FUN=${CREATIVE_MESSAGES[$RANDOM % ${#CREATIVE_MESSAGES[@]}]}
              MESSAGE="$RANDOM_FUN%0A%0AğŸ“‚ *Project:* \$PROJECT_NAME%0Aâ„¹ï¸ Unknown event: ${{ github.event_name }}%0A%0AğŸ‘¤ *Assignee:* ${{ github.actor }}%0A%0AğŸ·ï¸ *Meta Code Team*"
          fi

          curl -s -X POST https://api.telegram.org/bot$BOT_TOKEN/sendMessage \
            -d chat_id=$CHAT_ID \
            -d message_thread_id="$TOPIC_ID" \
            -d parse_mode="Markdown" \
            -d text="$MESSAGE"
